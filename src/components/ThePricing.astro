---
import Segment from "./Segment.astro";
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import { homePricingPlan as tiers } from '@/assets/static.data';
import LucideCheck from './LucideCheck.astro';
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const mainPlan = tiers.filter(p => p.id !== 'tier-basic');
---
<section class="relative w-full py-16 lg:py-20 bg-gradient-to-b from-gray-50 to to-gray-100 dark:from-gray-900 dark:to-gray-950/15">
    <Segment
        title={t('price.segment.title')}
        subTitle={t('price.segment.subTitle')}
        shortDescription={t('price.segment.description')}
    />
     <div id="pricing-section" class="relative isolate px-4">
        <div class="mx-auto mt-16 grid grid-cols-1 md:grid-cols-2 lg:max-w-5xl items-center gap-y-4">
            {mainPlan.map((tier, tierIdx) => {
                const wrapperClass = `
                  ${tier.featured ? 'relative bg-gray-900 shadow-2xl' : 'bg-white/60 dark:bg-sky-500 sm:mx-8 lg:mx-0'} 
                  ${tier.featured ? '' : tierIdx === 0 ? 'rounded-t-3xl sm:rounded-b-none lg:rounded-tr-none lg:rounded-bl-3xl' : 'sm:rounded-t-none lg:rounded-tr-3xl lg:rounded-bl-none'}
                  rounded-3xl p-6 ring-1 ring-gray-900/10
                `;

                const titleClass = `
                    ${tier.featured ? 'text-sky-400' : 'text-sky-600 dark:text-white'}
                    text-base/7 font-semibold
                `;

                const priceClass = `
                    ${tier.featured ? 'text-white' : 'text-gray-900 dark:text-white'}
                    text-5xl font-semibold tracking-tight
                `;

                const perMonthClass = `
                    ${tier.featured ? 'text-gray-400' : 'text-gray-500 dark:text-white'}
                    text-base
                `;

                const descriptionClass = `
                    ${tier.featured ? 'text-gray-300' : 'text-gray-600 dark:text-gray-100'}
                    mt-6 text-base/7
                `;

                const listClass = `
                    ${tier.featured ? 'text-gray-300' : 'text-gray-600 dark:text-white'}
                    mt-8 space-y-3 text-sm/6 sm:mt-10
                `;

                return (
                    <div class={wrapperClass}>
                    <h3 id={tier.id} class={titleClass}>{tier.name}</h3>
                    <p class="mt-4 flex items-baseline gap-x-2">
                        <span class={priceClass}>{tier.priceMonthly}</span>
                        <span class={perMonthClass}>/{t('price.segment.month')}</span>
                    </p>
                    <p class={descriptionClass}>{tier.description}</p>
                    <ul role="list" class={listClass}>
                        {tier.features.map((feature, i) => (
                        <li class="flex gap-x-3">
                            <LucideCheck
                                class={`${tier.featured ? 'text-sky-400' : 'text-sky-600 dark:text-white'} h-6 w-5 flex-none`}
                                aria-hidden="true"
                            />
                            {feature}
                        </li>
                        ))}
                    </ul>
                    <div class="flex items-center justify-end">
                        <a
                            href={tier.href}
                            aria-describedby={tier.id}
                            class={`
                                ${tier.featured
                                ? 'bg-sky-500 text-white shadow-xs hover:bg-sky-400 focus-visible:outline-sky-500'
                                : 'text-sky-600 bg-white hover:bg-gray-50 ring-1 ring-sky-200 ring-inset hover:ring-sky-300 focus-visible:outline-sky-600'}
                                mt-8 w-max py-2 px-4 rounded-lg lg:cursor-pointer block text-center text-sm font-semibold focus-visible:outline-2 focus-visible:outline-offset-2 sm:mt-10
                            `}
                            >
                            {t('price.segment.cta')}
                        </a>
                    </div>          
                </div>
                );
            })}
        </div>
        <div class="max-w-5xl mx-auto mt-10 dark:text-white">
            <p class="font-medium">{t('price.segment.note_title')}</p>
            <p>&bull; {t('price.segment.notes')}</p>
            <p>&bull; {t('price.segment.notes_1')}</p>
        </div>

    </div>
</section>